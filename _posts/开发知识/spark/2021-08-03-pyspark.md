---
layout:     post
title:      "pyspark"
subtitle:   " \"pyspark\""
date:       2021-08-03 18:00:00
mathjax: true
author:     "zwt"
header-img: "img/post-bg-2015.jpg"
catalog: false
tags:
    - spark
---
* TOC
{:toc}

# 操作
```
1.pandas转pyspark：spark_df = sqlContest.createDataFrame(df)
2.一行拆分多行：movies.withColumn("genre", explode(split($"genre", "[|]"))).show
3.df.groupby("id").agg(F.collect_set("code"))
4.一列拆分多列：val Df2 = Df1.withColumn("splitcol",split(col("contents"), ",")).select(
            col("splitcol").getItem(0).as("col1"),
            col("splitcol").getItem(1).as("col2"),
            col("splitcol").getItem(2).as("col3")
        ).drop("splitcol");
5. 列重命名：df.withColumnRenamed("user_id", "user")
6. service_result = df_info.withColumn("service_explode", explode(col("service_prod_code")))
7. 添加id列：df.withColumn("id", monotonically_increasing_id)
8. 交集：sentenceDataFrame1.select("sentence").intersect(sentenceDataFrame.select("sentence"))
9. union并集
10. subtract差集
11. 过滤：numeric_filtered = df.where((col('LOW')    != 'null'))).show()
12. 修改列名：.withColumnRenamed
13. 新增一列：df.withColumn('column', lit(10))
14. 连接mysql操作：df.write.format('jdbc').options(url='', driver='',dbtable='',user='',password='').model('append').save()
15. 去重：df = df.dropDuplicates()
16. 修改列类型：df.select(df.col("col1").cast(DoubleType)).show()
17. 增加自增列：val spec = Window.partitionBy().orderBy($"lon") 
val df1 = dataframe.withColumn("id", row_number().over(spec))
18.排序：df.orderBy('column_name', ascending=False)
```
# model
导出为pmml
```
1.pip install pyspark2pmml
2.下载对应的jar包：https://github.com/jpmml/pyspark2pmml
3.submit提交对应的jar包：'spark.jars', 'jpmml-sparkml-executable-1.5.12.jar'
```